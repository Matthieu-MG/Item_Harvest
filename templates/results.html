{% extends 'layout.html' %}

{% block title %}
    Results
{% endblock %}

{% block main %}
    
    <script>

        // Stores all the items checked by user
        items_added = []

        // Sends all of the items in items_added to server and redirects to /wishlist route
        function addToWishlist(){
            $.ajax({
                url: '/add',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'wishlist': items_added}),
            }).done(function(data){
                window.location.href = '/wishlist'
            })
        }
        
        function add_remove(checkbox){

            // Gets item's id
            let id = checkbox.value
            if (checkbox.checked){

                console.log("adding to array")
                // adds item to end of array
                items_added.push(id)
                console.log(items_added)

            }
            else{

                // Gets index of item's id in array
                const index = items_added.indexOf(id)

                // If id is in items_added array, remove it
                if (index > -1){

                    // The second parameter means remove only one
                    items_added.splice(index, 1)
                }
                console.log("unchecked")
            }
        }
    </script>

    <div class="center lightpadding">
        <button class="btn btn-success" onclick="addToWishlist()">
            Add To Wishlist
        </button>
    </div>
    
    <div class="table-responsive-sm">
        <table class="table">
            <thead class="table-warning">
                <tr>
                    <th>Item</th>
                    <th>Price</th>
                    <th>Retailer</th>
                    <th>URL</th>
                    <th>ADD</th>
                </tr>
            </thead>
            <tbody>
                {% for item in s_results %}
                    <tr class="table-dark">
                        <td>{{ item.item_name }}</td>
                        <td>{{ item.price }}</td>
                        <td>{{ item.retailer }}</td>
                        <td>{{ item.link }}</td>
                        <td>
                            <input type="checkbox" value="{{ item.id }}" onchange="add_remove(this)">
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}